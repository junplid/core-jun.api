generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RootUsers {
  id       Int    @id @default(autoincrement())
  hash     String @default(uuid())
  email    String
  password String

  @@index([id, email, hash])
}

model RootConnectionWA {
  id             Int           @id @default(autoincrement())
  connectionWAId Int?
  ConnectionWA   ConnectionWA? @relation(fields: [connectionWAId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@index([id, connectionWAId])
}

// enum TypeExtraPackages {
//   business
//   connections
//   users
//   attendants
//   flows
//   marketingSends
//   chatbotConversations
//   contactsWA
//   schedulingTool
//   documentsTool
//   multiserviceTool
//   databaseTool
//   storageSize
// }

// enum TypeCycleExtraPackages {
//   WEEKLY
//   BIWEEKLY
//   MONTHLY
//   BIMONTHLY
//   QUARTERLY
//   SEMIANNUALLY
//   YEARLY
// }

// model ExtraPackages {
//   id                    Int                     @id @default(autoincrement())
//   type                  TypeExtraPackages
//   name                  String
//   allPlans              Boolean                 @default(false)
//   status                Boolean                 @default(false)
//   newSubscribers        Boolean                 @default(false)
//   description           String?
//   amount                Int // refereci a quantidade que o recurso vai ter(TYPE: CONEXÕES, ...)
//   textOnPage            String?
//   periodValidityStart   DateTime?
//   periodValidityEnd     DateTime?
//   cycle                 TypeCycleExtraPackages
//   price                 Decimal                 @db.Decimal(6, 2)
//   createAt              DateTime                @default(now())
//   updateAt              DateTime                @default(now()) @updatedAt
//   ExtraPackageOnPlans   ExtraPackageOnPlans[]
//   AccountSubscriptions  AccountSubscriptions[]
//   ApplicableCoupons     ApplicableCoupons[]
//   ExtraPackageOnAccount ExtraPackageOnAccount[]

//   @@index([id, name, newSubscribers, status])
// }

// model ExtraPackageOnPlans {
//   id             Int           @id @default(autoincrement())
//   extraPackageId Int
//   ExtraPackages  ExtraPackages @relation(fields: [extraPackageId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   planId         Int
//   Plan           Plan          @relation(fields: [planId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, extraPackageId, planId])
// }

// model Geolocation {
//   id                    Int                     @id @default(autoincrement())
//   name                  String
//   address               String?
//   latitude              String
//   longitude             String
//   // ADICIONAR EM TODAS AS ROTAS DO GEO A COLUNA (accountId)
//   accountId             Int
//   Account               Account                 @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   GeolocationOnBusiness GeolocationOnBusiness[]

//   @@index([id, name])
// }

// model GeolocationOnBusiness {
//   id            Int         @id @default(autoincrement())
//   geolocationId Int
//   Geolocation   Geolocation @relation(fields: [geolocationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   businessId    Int
//   Business      Business    @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, geolocationId, businessId])
// }

model Account {
  id                  Int                   @id @default(autoincrement())
  isUsedFreeTrialTime Boolean               @default(false)
  name                String?               @db.VarChar(50)
  email               String                @unique @db.VarChar(200)
  cpfCnpj             String?               @unique
  hash                String                @default(uuid())
  isPremium           Boolean?              @default(false)
  emailVerified       Boolean               @default(false)
  password            String
  customerId          String?
  createAt            DateTime              @default(now())
  updateAt            DateTime              @default(now()) @updatedAt
  status              Boolean               @default(false)
  available           Boolean               @default(false)
  onboarded           Boolean               @default(false)
  assetsUsedId        Int
  AccountAssetsUsed   AccountAssetsUsed     @relation(fields: [assetsUsedId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  contactWAId         Int                   @unique
  ContactsWA          ContactsWA            @relation(fields: [contactWAId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  ContactsWAOnAccount ContactsWAOnAccount[]
  Business            Business[]
  Tag                 Tag[]
  Variable            Variable[]
  StoragePaths        StoragePaths[]
  Chatbot             Chatbot[]
  AccountLogDate      AccountLogDate[]
  Campaign            Campaign[]
  Audience            Audience[]
  ProviderCredential  ProviderCredential[]
  AgentAI             AgentAI[]
  InboxUsers          InboxUsers[]
  InboxDepartments    InboxDepartments[]
  Tickets             Tickets[]
  FbPixel             FbPixel[]
  Orders              Orders[]
  PaymentIntegrations PaymentIntegrations[]
  Charges             Charges[]
  LogSystem           LogSystem[]
  TrelloIntegration   TrelloIntegration[]
  MenuOnline          MenusOnline[]
  MenusOnlineItems    MenusOnlineItems[]
  notifications       Notifications[]
  pushTokens          PushTokens[]
  Appointments        Appointments[]

  @@index([id, email, hash, status, available, isUsedFreeTrialTime])
}

model InboxUsers {
  id                Int               @id @default(autoincrement())
  name              String            @db.VarChar(50)
  hash              String            @default(uuid())
  email             String            @unique @db.VarChar(200)
  password          String
  createAt          DateTime          @default(now())
  updateAt          DateTime          @default(now()) @updatedAt
  accountId         Int
  inboxDepartmentId Int?
  Account           Account?          @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  InboxDepartment   InboxDepartments? @relation(fields: [inboxDepartmentId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  Tickets           Tickets[]
  Messages          Messages[]
  Charges           Charges[]

  @@index([id, email, accountId, inboxDepartmentId])
}

model InboxDepartments {
  id             Int          @id @default(autoincrement())
  name           String       @db.VarChar(50)
  signBusiness   Boolean      @default(false)
  signDepartment Boolean      @default(false)
  signUser       Boolean      @default(false)
  previewNumber  Boolean      @default(true)
  previewPhoto   Boolean      @default(true)
  createAt       DateTime     @default(now())
  updateAt       DateTime     @default(now()) @updatedAt
  businessId     Int
  accountId      Int
  Business       Business     @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Account        Account      @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  InboxUsers     InboxUsers[]
  Tickets        Tickets[]

  @@index([id, name, businessId, accountId])
}

enum TypeStatusTicket {
  NEW
  OPEN
  RESOLVED
  DELETED
}

enum TypeDestinationTicket {
  department
  user
}

model Tickets {
  id                   Int                   @id @default(autoincrement())
  protocol             String
  status               TypeStatusTicket      @default(NEW)
  destination          TypeDestinationTicket
  createAt             DateTime              @default(now())
  updateAt             DateTime              @default(now()) @updatedAt
  accountId            Int
  Account              Account               @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  goBackFlowStateId    Int?
  GoBackFlowState      FlowState?            @relation(fields: [goBackFlowStateId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  inboxUserId          Int?
  InboxUser            InboxUsers?           @relation(fields: [inboxUserId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  inboxDepartmentId    Int
  InboxDepartment      InboxDepartments      @relation(fields: [inboxDepartmentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  contactWAOnAccountId Int
  ContactsWAOnAccount  ContactsWAOnAccount   @relation(fields: [contactWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  connectionWAId       Int
  ConnectionWA         ConnectionWA          @relation(fields: [connectionWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Messages             Messages[]
  Charges              Charges[]

  @@index([id, protocol, contactWAOnAccountId, status, destination, inboxDepartmentId, inboxUserId])
}

enum TypeSentBy {
  bot
  contact
  user
  system
}

model Messages {
  id               Int         @id @default(autoincrement())
  type             String
  by               TypeSentBy
  latitude         String      @default("")
  longitude        String      @default("")
  address          String      @default("")
  name             String      @default("")
  // definir linhas de tokens de entrada, saida e total, para mensurar quanto to tokens são usados por flowstate
  // e tao sera usado para metricas sobre qual tipo/tamanho de empresa usa quantos tokens por mês
  fullName         String      @default("")
  number           String      @default("")
  org              String      @default("")
  fileNameOriginal String      @default("")
  read             Boolean     @default(false)
  ptt              Boolean     @default(false)
  message          String      @db.Text
  caption          String      @default("")
  fileName         String      @default("")
  messageKey       String?
  flowStateId      Int?
  inboxUserId      Int?
  ticketsId        Int?
  FlowState        FlowState?  @relation(fields: [flowStateId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  InboxUser        InboxUsers? @relation(fields: [inboxUserId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  Tickets          Tickets?    @relation(fields: [ticketsId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  createAt         DateTime    @default(now())
  updateAt         DateTime    @default(now()) @updatedAt

  @@index([id, inboxUserId, ticketsId, flowStateId, messageKey, by, read])
}

model AccountAssetsUsed {
  id       Int @id @default(autoincrement())
  chatbots Int @default(0)
  leads    Int @default(0)

  Account Account[]

  @@index([id])
}

// // pacotes extra anexados ao ADM
// model ExtraPackageOnAccount {
//   id           Int           @id @default(autoincrement())
//   accountId    Int
//   Account      Account       @relation(fields: [accountId], references: [id], onDelete: Restrict, onUpdate: Cascade)
//   extraId      Int
//   ExtraPackage ExtraPackages @relation(fields: [extraId], references: [id], onDelete: Restrict, onUpdate: Cascade)

//   @@index([accountId])
// }

// enum TypeCreditCardBand {
//   VISA
//   MASTERCARD
//   ELO
//   DINERS
//   DISCOVER
//   AMEX
//   HIPERCARD
//   CABAL
//   BANESCARD
//   CREDZ
//   SOROCRED
//   CREDSYSTEM
//   JCB
//   UNKNOWN
// }

// model CreditCardsOnAccount {
//   id                   Int                    @id @default(autoincrement())
//   token                String
//   name                 String
//   band                 TypeCreditCardBand
//   numberCard           String
//   createAt             DateTime               @default(now())
//   accountId            Int
//   Account              Account                @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   AccountSubscriptions AccountSubscriptions[]

//   @@index([id])
// }

// enum TypeStatusAccountSubscriptions {
//   ON
//   OFF
//   WAITING
// }

// enum TypeAccountSubscriptions {
//   PLAN
//   EXTRA
// }

// enum StatusAccountSubscriptions {
//   REQUESTED
//   ACTIVE
//   INACTIVE
//   INTERRUPTED
// }

// ESSA TABELA É NESCESSARIO PARA PEGAR O planPeriodsId ou extraPackageId;
// ESSA TABELA PODERIA SER EXCLUIDA FACILMENTE PASSANDO O planPeriodsId ou extraPackageId E O TIPO "PLAN"|"EXTRA" no external da subscription

// enum BillingType {
//   PIX
//   CREDIT_CARD
//   BOLETO
// }

// model AccountSubscriptions {
//   id                 Int                      @id @default(autoincrement())
//   subscriptionsId    String
//   deleted            Boolean                  @default(false)
//   type               TypeAccountSubscriptions
//   billingType        BillingType
//   dateOfCancellation DateTime?
//   planPeriodsId      Int?
//   PlanPeriods        PlanPeriods?             @relation(fields: [planPeriodsId], references: [id], onDelete: Restrict, onUpdate: Cascade)
//   couponId           Int?
//   Coupon             Coupons?                 @relation(fields: [couponId], references: [id], onUpdate: Cascade, onDelete: SetNull)
//   creditCardId       Int?
//   CreditCard         CreditCardsOnAccount?    @relation(fields: [creditCardId], references: [id], onDelete: SetNull, onUpdate: Cascade)
//   extraPackageId     Int?
//   ExtraPackage       ExtraPackages?           @relation(fields: [extraPackageId], references: [id], onDelete: Restrict, onUpdate: Cascade)
//   accountId          Int
//   Account            Account                  @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   createAt           DateTime                 @default(now())
//   updateAt           DateTime                 @default(now()) @updatedAt

//   @@index([id, accountId, subscriptionsId, type])
// }

// model SubAccount {
//   id                          Int                          @id @default(autoincrement())
//   interrupted                 Boolean                      @default(false)
//   uid                         String                       @default(uuid())
//   name                        String                       @db.VarChar(50)
//   email                       String                       @unique @db.VarChar(200)
//   password                    String
//   createAt                    DateTime                     @default(now())
//   updateAt                    DateTime                     @default(now()) @updatedAt
//   status                      Boolean                      @default(false)
//   accountId                   Int
//   Account                     Account                      @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   SubAccountPermissionsCreate SubAccountPermissionsCreate?
//   SubAccountPermissionsDelete SubAccountPermissionsDelete?
//   SubAccountPermissionsUpdate SubAccountPermissionsUpdate?

//   @@index([id, email, accountId])
// }

// model SubAccountPermissionsCreate {
//   id                 Int        @id @default(autoincrement())
//   campaign           Boolean    @default(false)
//   business           Boolean    @default(false)
//   sector             Boolean    @default(false)
//   sectorAttendants   Boolean    @default(false)
//   flows              Boolean    @default(false)
//   emailService       Boolean    @default(false)
//   chatbot            Boolean    @default(false)
//   campaignAudience   Boolean    @default(false)
//   contactWAOnAccount Boolean    @default(false)
//   uploadFile         Boolean    @default(false)
//   checkpoint         Boolean    @default(false)
//   integration        Boolean    @default(false)
//   dataFlow           Boolean    @default(false)
//   campaignOndemand   Boolean    @default(false)
//   campaignParameters Boolean    @default(false)
//   connections        Boolean    @default(false)
//   supervisors        Boolean    @default(false)
//   servicesConfig     Boolean    @default(false)
//   users              Boolean    @default(false)
//   tags               Boolean    @default(false)
//   variables          Boolean    @default(false)
//   customizationLink  Boolean    @default(false)
//   subAccountId       Int        @unique
//   SubAccount         SubAccount @relation(fields: [subAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id])
// }

// model SubAccountPermissionsDelete {
//   id                 Int        @id @default(autoincrement())
//   campaign           Boolean    @default(false)
//   business           Boolean    @default(false)
//   sector             Boolean    @default(false)
//   sectorAttendants   Boolean    @default(false)
//   flows              Boolean    @default(false)
//   emailService       Boolean    @default(false)
//   chatbot            Boolean    @default(false)
//   campaignAudience   Boolean    @default(false)
//   contactWAOnAccount Boolean    @default(false)
//   uploadFile         Boolean    @default(false)
//   checkpoint         Boolean    @default(false)
//   integration        Boolean    @default(false)
//   dataFlow           Boolean    @default(false)
//   campaignOndemand   Boolean    @default(false)
//   campaignParameters Boolean    @default(false)
//   connections        Boolean    @default(false)
//   supervisors        Boolean    @default(false)
//   servicesConfig     Boolean    @default(false)
//   users              Boolean    @default(false)
//   tags               Boolean    @default(false)
//   variables          Boolean    @default(false)
//   customizationLink  Boolean    @default(false)
//   subAccountId       Int        @unique
//   SubAccount         SubAccount @relation(fields: [subAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id])
// }

// model SubAccountPermissionsUpdate {
//   id                 Int        @id @default(autoincrement())
//   campaign           Boolean    @default(false)
//   business           Boolean    @default(false)
//   sector             Boolean    @default(false)
//   sectorAttendants   Boolean    @default(false)
//   flows              Boolean    @default(false)
//   emailService       Boolean    @default(false)
//   chatbot            Boolean    @default(false)
//   campaignAudience   Boolean    @default(false)
//   contactWAOnAccount Boolean    @default(false)
//   uploadFile         Boolean    @default(false)
//   checkpoint         Boolean    @default(false)
//   integration        Boolean    @default(false)
//   dataFlow           Boolean    @default(false)
//   campaignOndemand   Boolean    @default(false)
//   campaignParameters Boolean    @default(false)
//   connections        Boolean    @default(false)
//   supervisors        Boolean    @default(false)
//   servicesConfig     Boolean    @default(false)
//   users              Boolean    @default(false)
//   tags               Boolean    @default(false)
//   variables          Boolean    @default(false)
//   customizationLink  Boolean    @default(false)
//   subAccountId       Int        @unique
//   SubAccount         SubAccount @relation(fields: [subAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id])
// }

// enum TypeIntegrations {
//   trello
// }

// model Integrations {
//   id          Int              @id @default(autoincrement())
//   interrupted Boolean          @default(false)
//   name        String
//   type        TypeIntegrations
//   key         String?
//   token       String?
//   createAt    DateTime         @default(now())
//   updateAt    DateTime         @default(now()) @updatedAt
//   accountId   Int
//   Account     Account          @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, type])
// }

// model CardsTrello {
//   id        Int      @id @default(autoincrement())
//   cardId    String   @unique
//   createAt  DateTime @default(now())
//   accountId Int
//   Account   Account  @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, cardId])
// }

// model AccountAuthorization {
//   id         Int     @id @default(autoincrement())
//   privateKey String
//   accountId  Int     @unique
//   Account    Account @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id])
// }

// enum AmountType {
//   PERCENTAGE
//   REAL
// }

// enum ApplicableTo {
//   PLANS
//   EXTRAS
// }

// model Coupons {
//   id                   Int                    @id @default(autoincrement())
//   name                 String
//   description          String?
//   status               Boolean                @default(true)
//   activationCode       String                 @unique
//   discountType         AmountType
//   discountValue        Float
//   validFrom            DateTime?
//   validUntil           DateTime?
//   maxQuantity          Int                    @default(0)
//   quantityUsed         Int                    @default(0)
//   isValidOnRenewal     Boolean                @default(false)
//   applicableTo         String?
//   createAt             DateTime               @default(now())
//   updateAt             DateTime               @default(now()) @updatedAt
//   ApplicableCoupons    ApplicableCoupons[]
//   Affiliates           Affiliates[]
//   AccountSubscriptions AccountSubscriptions[]

//   @@index([id])
// }

// model ApplicableCoupons {
//   id             Int            @id @default(autoincrement())
//   type           ApplicableTo
//   couponId       Int
//   Coupon         Coupons        @relation(fields: [couponId], references: [id], onUpdate: Cascade, onDelete: Cascade)
//   planId         Int?
//   Plans          Plan?          @relation(fields: [planId], references: [id], onUpdate: Cascade, onDelete: Cascade)
//   extraPackageId Int?
//   ExtraPackages  ExtraPackages? @relation(fields: [extraPackageId], references: [id], onUpdate: Cascade, onDelete: Cascade)

//   @@index([couponId, planId, extraPackageId])
// }

// enum PixKeyType {
//   CPF
//   CNPJ
//   EMAIL
//   PHONE
//   RANDOM
// }

// model Affiliates {
//   id                      Int                       @id @default(autoincrement())
//   subAccountId            String
//   reference               String                    @unique @default(uuid())
//   walletId                String
//   apiKey                  String
//   name                    String
//   description             String?
//   status                  Boolean                   @default(true)
//   email                   String                    @unique
//   pixKey                  String
//   pixKeyType              PixKeyType
//   commissionType          AmountType
//   commissionValue         Float
//   effectiveAfterDays      Int?
//   contactWAId             Int
//   ContactWA               ContactsWA                @relation(fields: [contactWAId], references: [id], onDelete: Restrict, onUpdate: Cascade)
//   couponId                Int?
//   Coupon                  Coupons?                  @relation(fields: [couponId], references: [id], onUpdate: Cascade, onDelete: SetNull)
//   createAt                DateTime                  @default(now())
//   updateAt                DateTime                  @default(now()) @updatedAt
//   HandleAccountAffiliates HandleAccountAffiliates[]

//   @@index([id, name, contactWAId, email, status])
// }

// model HandleAccountAffiliates {
//   id          Int        @id @default(autoincrement())
//   affiliateId Int
//   Affiliate   Affiliates @relation(fields: [affiliateId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   accountId   Int
//   Account     Account    @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   createAt    DateTime   @default(now())
//   updateAt    DateTime   @default(now()) @updatedAt

//   @@index([id, affiliateId, accountId])
// }

// model PlanOnPeriodsOnAccount {
//   id          Int          @id @default(autoincrement())
//   planId      Int
//   periodId    Int?
//   Plan        Plan         @relation(fields: [planId], references: [id], onDelete: Restrict, onUpdate: Cascade)
//   PlanPeriods PlanPeriods? @relation(fields: [periodId], references: [id], onDelete: Restrict, onUpdate: Cascade)
//   createAt    DateTime     @default(now())
//   updateAt    DateTime     @default(now()) @updatedAt

//   @@index([id])
// }

// aceita novos usuarios; - se tiver TRUE, aceita novos usuarios, se tiver FALSE não

// ativo para usuario existente; - se tiver TRUE, continua funcionando para quem 
//    já é assinante,  se tiver FALSE, para de funcionar para todos assinantes

// permite renovação; - se tiver TRUE, permite renovação, se tiver FALSE, não 
//    permite renovação tornando o plano inapito para uso(mostrar no frontend 
//    que a renovação foi desativada para o ADM escolher outro plano)

// model Plan {
//   id                     Int                      @id @default(autoincrement())
//   name                   String                   @db.VarChar(60)
//   acceptsNewUsers        Boolean                  @default(true)
//   activeFoSubscribers    Boolean                  @default(true)
//   allowsRenewal          Boolean                  @default(true)
//   description            String                   @db.Text
//   label                  String?
//   isDefault              Boolean                  @default(false)
//   free_trial_time        Int?
//   type                   TypePlan
//   createAt               DateTime                 @default(now())
//   updateAt               DateTime                 @default(now()) @updatedAt
//   PlanPeriods            PlanPeriods[]
//   PlanOnPeriodsOnAccount PlanOnPeriodsOnAccount[]
//   ExtraPackageOnPlans    ExtraPackageOnPlans[]
//   Account                Account[]
//   planAssetsId           Int                      @unique
//   PlanAssets             PlanAssets               @relation(fields: [planAssetsId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   ApplicableCoupons      ApplicableCoupons[]

//   @@index([id])
// }

// model PlanAssets {
//   id                               Int     @id @default(autoincrement())
//   business                         Int     @default(0)
//   connections                      Int     @default(0)
//   users                            Int     @default(0)
//   attendants                       Int     @default(0)
//   flow                             Int     @default(0)
//   marketingSends                   Int     @default(0)
//   storageSize                      Int     @default(0)
//   chatbots                         Int     @default(0)
//   contactsWA                       Int     @default(0)
//   nodeInitial                      Boolean @default(false)
//   nodeMessage                      Boolean @default(false)
//   nodeReply                        Boolean @default(false)
//   nodeSwitch                       Boolean @default(false)
//   nodeSendContactData              Boolean @default(false)
//   nodeSendVideo                    Boolean @default(false)
//   nodeSendPdf                      Boolean @default(false)
//   nodeSendFile                     Boolean @default(false)
//   nodeSendImage                    Boolean @default(false)
//   nodeSendAudio                    Boolean @default(false)
//   nodeSendLink                     Boolean @default(false)
//   nodeMathematicalOperators        Boolean @default(false)
//   nodeCheckPoint                   Boolean @default(false)
//   nodeInterruption                 Boolean @default(false)
//   nodeAction                       Boolean @default(false)
//   nodeEmailSending                 Boolean @default(false)
//   nodeLinkTackingPixel             Boolean @default(false)
//   nodeSendLocationGPS              Boolean @default(false)
//   nodeLogicalConditionData         Boolean @default(false)
//   nodeDistributeFlow               Boolean @default(false)
//   nodeNotifyNumber                 Boolean @default(false)
//   nodeSendHumanService             Boolean @default(false)
//   nodeInterruptionLinkTackingPixel Boolean @default(false)
//   nodeTime                         Boolean @default(false)
//   nodeWebhook                      Boolean @default(false)
//   nodeInsertLeaderInAudience       Boolean @default(false)
//   nodeWebform                      Boolean @default(false)
//   nodeNewCardTrello                Boolean @default(false)
//   nodeMenu                         Boolean @default(false)
//   Plan                             Plan?

//   @@index([id])
// }

// enum TypeCyclePlanPeriods {
//   WEEKLY
//   BIWEEKLY
//   MONTHLY
//   BIMONTHLY
//   QUARTERLY
//   SEMIANNUALLY
//   YEARLY
// }

// model PlanPeriods {
//   id                     Int                      @id @default(autoincrement())
//   label                  String?
//   cycle                  TypeCyclePlanPeriods
//   price_after_renovation Decimal?
//   price                  Decimal                  @db.Decimal(6, 2)
//   planId                 Int
//   Plan                   Plan                     @relation(fields: [planId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   PlanOnPeriodsOnAccount PlanOnPeriodsOnAccount[]
//   AccountSubscriptions   AccountSubscriptions[]

//   @@index([id, planId])
// }

model Business {
  id                     Int                      @id @default(autoincrement())
  interrupted            Boolean                  @default(false)
  name                   String                   @db.VarChar(50)
  description            String?
  accountId              Int
  createAt               DateTime                 @default(now())
  updateAt               DateTime                 @default(now()) @updatedAt
  Account                Account                  @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ConnectionWA           ConnectionWA[]
  TagOnBusiness          TagOnBusiness[]
  VariablesOnBusiness    VariableOnBusiness[]
  Chatbot                Chatbot[]
  CampaignOnBusiness     CampaignOnBusiness[]
  AudienceOnBusiness     AudienceOnBusiness[]
  StoragePathsOnBusiness StoragePathsOnBusiness[]
  AgentAIOnBusiness      AgentAIOnBusiness[]
  InboxDepartments       InboxDepartments[]
  FbPixel                FbPixel[]
  Orders                 Orders[]
  Charges                Charges[]
  Appointments           Appointments[]

  @@index([id, accountId])
}

enum TypeConnetion {
  chatbot
  marketing
}

model ConnectionWA {
  id                   Int                    @id @default(autoincrement())
  interrupted          Boolean                @default(false)
  name                 String                 @db.VarChar(50)
  description          String?
  type                 TypeConnetion
  countShots           Int                    @default(0)
  number               String?
  createAt             DateTime               @default(now())
  updateAt             DateTime               @default(now()) @updatedAt
  businessId           Int
  Business             Business               @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Chatbot              Chatbot[]
  ConnectionConfig     ConnectionConfig?
  RootConnectionWA     RootConnectionWA[]
  FlowState            FlowState[]
  ConnectionOnCampaign ConnectionOnCampaign[]
  Tickets              Tickets[]
  LogSystem            LogSystem[]
  ConnectionWAOnGroups ConnectionWAOnGroups[]
  Orders               Orders[]
  MenusOnline          MenusOnline[]
  Appointments         Appointments[]
  AgentAI              AgentAI?

  @@index([id, name, type, number])
}

model ConnectionWAOnGroups {
  id             Int          @id @default(autoincrement())
  name           String
  jid            String
  connectionWAId Int
  ConnectionWA   ConnectionWA @relation(fields: [connectionWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([name, connectionWAId, id])
}

enum WAPrivacyValue {
  all
  contacts
  contact_blacklist
  none
}

enum WAPrivacyValueGroup {
  all
  contacts
  contact_blacklist
}

enum WAPrivacyOnlineValue {
  all
  match_last_seen
}

enum WAReadReceiptsValue {
  all
  none
}

model ConnectionConfig {
  profileName         String?
  profileStatus       String?
  lastSeenPrivacy     WAPrivacyValue?
  onlinePrivacy       WAPrivacyOnlineValue?
  imgPerfilPrivacy    WAPrivacyValue?
  statusPrivacy       WAPrivacyValue?
  groupsAddPrivacy    WAPrivacyValueGroup?
  readReceiptsPrivacy WAReadReceiptsValue?
  fileNameImgPerfil   String?
  connectionWAId      Int                   @unique
  ConnectionWA        ConnectionWA          @relation(fields: [connectionWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([connectionWAId])
}

//   schedulingTool
//   documentsTool
//   multiserviceTool
//   databaseTool

// model CampaignParameter {
//   id                                  Int                               @id @default(autoincrement())
//   interrupted                         Boolean                           @default(false)
//   name                                String                            @db.VarChar(60)
//   rootCampaignParameterRangesConfigId Int
//   RootCampaignParameterRangesConfig   RootCampaignParameterRangesConfig @relation(fields: [rootCampaignParameterRangesConfigId], references: [id], onDelete: Restrict, onUpdate: Cascade)
//   sendDuringHoliday                   Boolean
//   createAt                            DateTime                          @default(now())
//   updateAt                            DateTime                          @default(now()) @updatedAt
//   accountId                           Int
//   Account                             Account                           @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   Campaign                            Campaign[]
//   OperatingDays                           OperatingDays[]

//   @@index([id, accountId, name])
// }

model OperatingDays {
  id           Int            @id @default(autoincrement())
  dayOfWeek    Int
  chatbotId    Int?
  campaignId   Int?
  Chatbot      Chatbot?       @relation(fields: [chatbotId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Campaign     Campaign?      @relation(fields: [campaignId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  WorkingTimes WorkingTimes[]

  @@index([id, chatbotId, campaignId])
}

model WorkingTimes {
  id             Int           @id @default(autoincrement())
  start          String
  end            String
  operatingDayId Int
  OperatingDays  OperatingDays @relation(fields: [operatingDayId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([id, operatingDayId])
}

enum TypeAudience {
  ondemand
  static
  interactions
  import
}

model Audience {
  id                   Int                    @id @default(autoincrement())
  interrupted          Boolean                @default(false)
  name                 String                 @db.VarChar(150)
  type                 TypeAudience
  createAt             DateTime               @default(now())
  updateAt             DateTime               @default(now()) @updatedAt
  accountId            Int
  Account              Account                @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  AudienceOnBusiness   AudienceOnBusiness[]
  AudienceOnCampaign   AudienceOnCampaign[]
  ContactsWAOnAudience ContactsWAOnAudience[]
  FlowState            FlowState[]

  @@index([id, type, name, accountId])
}

model ContactsWAOnAudience {
  id                   Int                 @id @default(autoincrement())
  createAt             DateTime            @default(now())
  updateAt             DateTime            @default(now()) @updatedAt
  audienceId           Int
  contactWAOnAccountId Int
  Audience             Audience            @relation(fields: [audienceId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ContactsWAOnAccount  ContactsWAOnAccount @relation(fields: [contactWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([contactWAOnAccountId, audienceId])
}

model AudienceOnCampaign {
  id         Int      @id @default(autoincrement())
  campaignId Int
  audienceId Int
  Campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Audience   Audience @relation(fields: [audienceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([campaignId, audienceId])
}

model AudienceOnBusiness {
  id         Int      @id @default(autoincrement())
  businessId Int
  Business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  audienceId Int
  Audience   Audience @relation(fields: [audienceId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

enum TypeFlowState {
  campaign
  chatbot
}

model FlowState {
  id                    Int                  @id @default(autoincrement())
  isSent                Boolean              @default(false)
  firedOnDate           DateTime?
  isFinish              Boolean?             @default(false)
  indexNode             String?
  agentId               Int?
  fbc                   String?
  fbp                   String?
  ua                    String?
  expires_at            DateTime?
  ip                    String?
  flowId                String?
  previous_response_id  String?
  totalTokens           Int                  @default(0)
  inputTokens           Int                  @default(0)
  outputTokens          Int                  @default(0)
  fallbackSent          Boolean              @default(false)
  createAt              DateTime             @default(now())
  updateAt              DateTime             @default(now()) @updatedAt
  campaignId            Int?
  contactsWAOnAccountId Int?
  connectionWAId        Int?
  audienceId            Int?
  chatbotId             Int?
  Chatbot               Chatbot?             @relation(fields: [chatbotId], references: [id], onDelete: SetNull, onUpdate: SetNull)
  Audience              Audience?            @relation(fields: [audienceId], references: [id], onDelete: SetNull, onUpdate: SetNull)
  Campaign              Campaign?            @relation(fields: [campaignId], references: [id], onDelete: SetNull, onUpdate: SetNull)
  ContactsWAOnAccount   ContactsWAOnAccount? @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ConnectionWA          ConnectionWA?        @relation(fields: [connectionWAId], references: [id], onDelete: SetNull, onUpdate: SetNull)
  Tickets               Tickets[]
  Messages              Messages[]
  Orders                Orders[]
  Charges               Charges[]
  Appointments          Appointments[]

  @@index([id, flowId, campaignId, contactsWAOnAccountId, connectionWAId, audienceId, isSent, isFinish, createAt])
}

// enum TypeLogFlowState {
//   CONNECTIONWA_INVALID
//   CONNECTIONWA_NOT_FOUND
//   CAMPAIGN_NOT_FOUND
//   CAMPAIGN_FINISHED
//   CAMPAIGN_NOT_RUNNING
// }

// model LogOnFlowState {
//   id         Int      @id @default(autoincrement())
//   flowStateId Int
//   FlowState  FlowState @relation(fields: [flowStateId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   log        String
//   createAt   DateTime @default(now())

//   @@index([flowStateId])
// }

model ConnectionOnCampaign {
  id             Int          @id @default(autoincrement())
  connectionWAId Int
  campaignId     Int
  ConnectionWA   ConnectionWA @relation(fields: [connectionWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Campaign       Campaign     @relation(fields: [campaignId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([campaignId, connectionWAId])
}

model CampaignOnBusiness {
  id         Int      @id @default(autoincrement())
  businessId Int
  campaignId Int
  Business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([id, businessId, campaignId])
}

enum TypeStatusCampaign {
  stopped
  processing
  paused
  running
  finished
}

model HasTag_Campaign {
  id         Int      @id @default(autoincrement())
  tagId      Int
  Tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  campaignId Int
  Campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([campaignId])
}

model Campaign {
  id                   Int                    @id @default(autoincrement())
  description          String?
  name                 String                 @db.VarChar(160)
  status               TypeStatusCampaign     @default(processing)
  timeItWillStart      String?
  flowId               String
  createAt             DateTime               @default(now())
  updateAt             DateTime               @default(now()) @updatedAt
  accountId            Int
  shootingSpeedId      Int
  Account              Account                @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ShootingSpeed        ShootingSpeed          @relation(fields: [shootingSpeedId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  FlowState            FlowState[]
  OperatingDays        OperatingDays[]
  CampaignOnBusiness   CampaignOnBusiness[]
  AudienceOnCampaign   AudienceOnCampaign[]
  ConnectionOnCampaign ConnectionOnCampaign[]
  HasTag_Campaign      HasTag_Campaign[]

  @@index([name, accountId, flowId, createAt, status])
}

enum TypeActivation {
  message
  qrcode
  link
}

enum TypeMessageWhatsApp {
  textDetermined
  anyMessage
}

enum TypeTime {
  seconds
  minutes
  hours
  days
}

model TimeToRestartChatbot {
  chatbotId Int      @id
  value     Int
  type      TypeTime
  Chatbot   Chatbot  @relation(fields: [chatbotId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([chatbotId])
}

model Chatbot {
  id                    Int                   @id @default(autoincrement())
  interrupted           Boolean               @default(false)
  cbj                   String                @default(uuid())
  name                  String                @db.VarChar(60)
  status                Boolean?              @default(false)
  description           String?
  connectionWAId        Int?
  leadOriginList        String?
  destLink              String?               @db.Text
  fallback              String?               @db.Text
  flowId                String
  addLeadToAudiencesIds Int[]                 @default([])
  addToLeadTagsIds      Int[]                 @default([])
  trigger               String?               @db.VarChar(160)
  flowBId               String?
  ConnectionWA          ConnectionWA?         @relation(fields: [connectionWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  businessId            Int
  Business              Business              @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  accountId             Int
  Account               Account               @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  createAt              DateTime              @default(now())
  updateAt              DateTime              @default(now()) @updatedAt
  OperatingDays         OperatingDays[]
  TimeToRestart         TimeToRestartChatbot?
  FlowState             FlowState[]
  AgentAI               AgentAI?

  @@index([name, accountId, businessId, status])
}

enum TypeChatbotInactivity {
  seconds
  minutes
  hours
  days
}

model ContactsWA {
  id                  Int                   @id @default(autoincrement())
  img                 String                @default("") @db.VarChar(250)
  completeNumber      String                @unique
  createAt            DateTime              @default(now())
  updateAt            DateTime              @default(now()) @updatedAt
  ContactsWAOnAccount ContactsWAOnAccount[]
  Account             Account[]

  @@index([id, completeNumber, createAt])
}

model ContactsWAOnAccount {
  id                          Int                           @id @default(autoincrement())
  interrupted                 Boolean                       @default(false)
  name                        String                        @db.VarChar(150)
  accountId                   Int
  contactWAId                 Int
  createAt                    DateTime                      @default(now())
  updateAt                    DateTime                      @default(now()) @updatedAt
  ContactsWA                  ContactsWA                    @relation(fields: [contactWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Account                     Account                       @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  TagOnContactsWAOnAccount    TagOnContactsWAOnAccount[]
  ContactsWAOnAccountVariable ContactsWAOnAccountVariable[]
  FlowState                   FlowState[]
  DocumentsOnContact          DocumentsOnContact[]
  ContactsWAOnAudience        ContactsWAOnAudience[]
  Tickets                     Tickets[]
  Orders                      Orders[]
  Charges                     Charges[]
  Appointments                Appointments[]

  @@index([id, contactWAId, createAt])
}

model DocumentsOnContact {
  id                  Int                 @id @default(autoincrement())
  name                String
  type                String
  contactAccountId    Int
  ContactsWAOnAccount ContactsWAOnAccount @relation(fields: [contactAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([id, name, contactAccountId])
}

model Tag {
  id                       Int                        @id @default(autoincrement())
  interrupted              Boolean                    @default(false)
  name                     String                     @db.VarChar(150)
  accountId                Int
  Account                  Account                    @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  type                     TypeTag
  TagOnBusiness            TagOnBusiness[]
  TagOnContactsWAOnAccount TagOnContactsWAOnAccount[]
  HasTag_Campaign          HasTag_Campaign[]

  @@index([name, type, accountId])
}

model TagOnBusiness {
  id         Int      @id @default(autoincrement())
  tagId      Int
  businessId Int
  Tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([id, tagId, businessId])
}

model TagOnContactsWAOnAccount {
  id                    Int                 @id @default(autoincrement())
  tagId                 Int
  Tag                   Tag                 @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  contactsWAOnAccountId Int
  ContactsWAOnAccount   ContactsWAOnAccount @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([tagId, contactsWAOnAccountId])
}

// model TagOnAudience {
//   id         Int      @id @default(autoincrement())
//   tagId      Int
//   audienceId Int
//   Tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   Audience   Audience @relation(fields: [audienceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([tagId, audienceId])
// }

enum TypeVariable {
  dynamics
  constant
  system
}

model Variable {
  id                          Int                           @id @default(autoincrement())
  interrupted                 Boolean                       @default(false)
  type                        TypeVariable                  @default(dynamics)
  name                        String                        @db.VarChar(150)
  value                       String?
  accountId                   Int?
  Account                     Account?                      @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  VariableOnBusiness          VariableOnBusiness[]
  ContactsWAOnAccountVariable ContactsWAOnAccountVariable[]

  @@index([name, id, accountId, type])
}

model VariableOnBusiness {
  id         Int      @id @default(autoincrement())
  variableId Int
  businessId Int
  Variable   Variable @relation(fields: [variableId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([variableId, businessId])
}

model ContactsWAOnAccountVariable {
  id                    Int                 @id @default(autoincrement())
  value                 String
  contactsWAOnAccountId Int
  variableId            Int
  ContactsWAOnAccount   ContactsWAOnAccount @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Variable              Variable            @relation(fields: [variableId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([value, variableId, contactsWAOnAccountId])
}

model StoragePaths {
  id                     Int                      @id @default(autoincrement())
  name                   String?
  originalName           String
  fileName               String
  size                   Float
  mimetype               String?
  createAt               DateTime                 @default(now())
  accountId              Int
  Account                Account                  @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  StoragePathsOnBusiness StoragePathsOnBusiness[]
  StoragePathOnAgentAI   StoragePathOnAgentAI[]

  @@index([name, id])
}

model StoragePathsOnBusiness {
  id            Int          @id @default(autoincrement())
  businessId    Int
  storagePathId Int
  Business      Business     @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  StoragePaths  StoragePaths @relation(fields: [storagePathId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([businessId, storagePathId])
}

// model Checkpoint {
//   id                              Int                               @id @default(autoincrement())
//   interrupted                     Boolean                           @default(false)
//   name                            String
//   score                           Int
//   accountId                       Int
//   Account                         Account                           @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   createAt                        DateTime                          @default(now())
//   updateAt                        DateTime                          @default(now()) @updatedAt
//   CheckpointOnBusiness            CheckpointOnBusiness[]
//   CheckpointOnContactsWAOnAccount CheckpointOnContactsWAOnAccount[]

//   @@index([name, id, accountId])
// }

// model CheckpointOnBusiness {
//   id           Int        @id @default(autoincrement())
//   businessId   Int
//   checkpointId Int
//   Business     Business   @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   Checkpoint   Checkpoint @relation(fields: [checkpointId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, businessId, checkpointId])
// }

// model CheckpointOnContactsWAOnAccount {
//   id                    Int                 @id @default(autoincrement())
//   flowId                Int
//   createAt              DateTime            @default(now())
//   updateAt              DateTime            @default(now()) @updatedAt
//   checkpointId          Int
//   Checkpoint            Checkpoint          @relation(fields: [checkpointId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   contactsWAOnAccountId Int
//   ContactsWAOnAccount   ContactsWAOnAccount @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, flowId, createAt, checkpointId])
// }

// model Supervisors {
//   id                    Int                     @id @default(autoincrement())
//   hash                  String                  @default(uuid())
//   interrupted           Boolean                 @default(false)
//   name                  String
//   username              String                  @unique
//   password              String
//   createAt              DateTime                @default(now())
//   updateAt              DateTime                @default(now()) @updatedAt
//   imageName             String?
//   accountId             Int
//   Account               Account                 @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   BusinessOnSupervisors BusinessOnSupervisors[]
//   Sectors               Sectors[]

//   @@index([id, username, password, hash])
// }

// model BusinessOnSupervisors {
//   id            Int         @id @default(autoincrement())
//   supervisorsId Int
//   Supervisors   Supervisors @relation(fields: [supervisorsId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   businessId    Int
//   Business      Business    @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, businessId, supervisorsId])
// }

// enum TypeBehaviorLackResponse {
//   sendSector
//   sendFlow
//   sendMessage
//   finish
//   sendAttendant
// }

// model Sectors {
//   id                        Int                     @id @default(autoincrement())
//   interrupted               Boolean                 @default(false)
//   status                    Boolean                 @default(true)
//   name                      String
//   messageOutsideOfficeHours String?
//   typeDistribution          TypeDistributionSectors
//   signBusiness              Boolean                 @default(false)
//   signSector                Boolean                 @default(false)
//   signAttendant             Boolean                 @default(false)
//   maximumService            Int?
//   operatingDays             String?
//   timeToSendToAllSectors    Int?
//   fromTime                  String?
//   toTime                    String?
//   addTag                    Boolean                 @default(false)
//   removeTicket              Boolean                 @default(false)
//   previewPhone              Boolean                 @default(false)
//   accountId                 Int
//   Account                   Account                 @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   supervisorsId             Int?
//   Supervisors               Supervisors?            @relation(fields: [supervisorsId], references: [id], onDelete: SetNull, onUpdate: Cascade)
//   businessId                Int
//   Business                  Business                @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   funnelKanbanId            Int?
//   FunnelKanban              FunnelKanban?           @relation(fields: [funnelKanbanId], references: [id], onDelete: SetNull, onUpdate: Cascade)

//   createAt DateTime @default(now())
//   updateAt DateTime @default(now()) @updatedAt

//   LackResponses        LackResponses?
//   SectorsMessages      SectorsMessages?
//   SectorsAttendants    SectorsAttendants[]
//   Tickets              Tickets[]
//   SectorsOnConnections SectorsOnConnections[]

//   @@index([id, name, typeDistribution, operatingDays])
// }

// model SectorsOnConnections {
//   id                   Int                  @id @default(autoincrement())
//   sectorId             Int
//   Sectors              Sectors              @relation(fields: [sectorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   connectionWAId         Int
//   ConnectionOnBusiness ConnectionOnBusiness @relation(fields: [connectionWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([connectionWAId, sectorId])
// }

// model SectorsAttendants {
//   id                             Int                              @id @default(autoincrement())
//   hash                           String                           @default(uuid())
//   interrupted                    Boolean                          @default(false)
//   name                           String
//   office                         String
//   status                         Boolean                          @default(false)
//   allowInsertionAndRemovalOfTags Boolean                          @default(false)
//   allowToUseQuickMessages        Boolean                          @default(false)
//   allowReOpeningATicket          Boolean                          @default(false)
//   allowStartingNewTicket         Boolean                          @default(false)
//   allowAddingNotesToLeadProfile  Boolean                          @default(false)
//   previewTicketSector            Boolean                          @default(false)
//   previewTicketBusiness          Boolean                          @default(false)
//   username                       String                           @unique
//   password                       String
//   createAt                       DateTime                         @default(now())
//   updateAt                       DateTime                         @default(now()) @updatedAt
//   imageName                      String?
//   sectorsId                      Int?
//   Sectors                        Sectors?                         @relation(fields: [sectorsId], references: [id], onDelete: SetNull, onUpdate: Cascade)
//   accountId                      Int
//   Account                        Account                          @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   businessId                     Int
//   Business                       Business                         @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   ConversationTickes             ConversationTickes[]
//   Tickets                        Tickets[]
//   NotificationsSectorsAttendants NotificationsSectorsAttendants[]
//   FastMessage                    FastMessage[]

//   @@index([id, username, sectorsId, accountId, businessId, hash])
// }

// model FastMessage {
//   id          Int               @id @default(autoincrement())
//   shortcut    String
//   value       String            @db.Text
//   attendantId Int
//   Attendant   SectorsAttendants @relation(fields: [attendantId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, shortcut])
// }

// enum TypeStatusNotificationSectorAttendant {
//   read
//   unread
// }

// model NotificationsSectorsAttendants {
//   id                 Int                                   @id @default(autoincrement())
//   subject            String
//   content            String
//   createAt           DateTime                              @default(now())
//   updateAt           DateTime                              @default(now()) @updatedAt
//   status             TypeStatusNotificationSectorAttendant @default(unread)
//   sectorsAttendantId Int
//   SectorsAttendants  SectorsAttendants                     @relation(fields: [sectorsAttendantId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, sectorsAttendantId])
// }

// model SectorsMessages {
//   id                         Int     @id @default(autoincrement())
//   messageWelcome             String?
//   messageWelcomeToOpenTicket String?
//   messageFinishService       String?
//   messageTransferTicket      String?
//   sectorsId                  Int     @unique
//   Sectors                    Sectors @relation(fields: [sectorsId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   accountId                  Int
//   Account                    Account @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id])
// }

// model LackResponses {
//   id            Int                      @id @default(autoincrement())
//   valueDuration Int
//   typeDuration  TypeTimeLackResponse
//   typeBehavior  TypeBehaviorLackResponse
//   sendSector    Int?
//   sendFlow      Int?
//   sendMessage   String?
//   // sendAttendant Int?
//   finish        Boolean?
//   accountId     Int
//   Account       Account                  @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   sectorsId     Int                      @unique
//   Sectors       Sectors                  @relation(fields: [sectorsId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, typeDuration, typeBehavior, accountId, sectorsId])
// }

// model FunnelKanban {
//   id                Int                 @id @default(autoincrement())
//   interrupted       Boolean             @default(false)
//   name              String
//   createAt          DateTime            @default(now())
//   updateAt          DateTime            @default(now()) @updatedAt
//   StepsFunnelKanban StepsFunnelKanban[]
//   businessId        Int
//   Business          Business            @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   accountId         Int
//   Account           Account             @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   Sectors           Sectors[]

//   @@index([id])
// }

// model StepsFunnelKanban {
//   id                         Int                          @id @default(autoincrement())
//   name                       String
//   color                      String                       @default("")
//   sequence                   Int
//   funnelKanbanId             Int
//   FunnelKanban               FunnelKanban                 @relation(fields: [funnelKanbanId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   accountId                  Int
//   Account                    Account                      @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   StepsFunnelKanbanOnTickets StepsFunnelKanbanOnTickets[]

//   @@index([id])
// }

model ShootingSpeed {
  id               Int        @id @default(autoincrement())
  name             String
  timeBetweenShots Int
  timeRest         Int
  numberShots      Int
  sequence         Int
  status           Boolean    @default(true)
  Campaign         Campaign[]

  @@index([id, name, status])
}

// model StepsFunnelKanbanOnTickets {
//   sequence            Int
//   stepsFunnelKanbanId Int
//   StepsFunnelKanban   StepsFunnelKanban @relation(fields: [stepsFunnelKanbanId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   ticketsId           Int               @id @unique
//   Tickets             Tickets           @relation(fields: [ticketsId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([stepsFunnelKanbanId, ticketsId])
// }

// model HumanServiceOnBusinessOnContactsWAOnAccount {
//   id                     Int                      @id @default(autoincrement())
//   contactsWAOnAccountId  Int                      @unique
//   ContactsWAOnAccount    ContactsWAOnAccount      @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   businessId             Int
//   Business               Business                 @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   HumanServiceReportLead HumanServiceReportLead[]

//   @@index([id, contactsWAOnAccountId, businessId])
// }

// enum TypeHumanServiceReportLead {
//   note
//   pendency
// }

// model HumanServiceReportLead {
//   id                                            Int                                         @id @default(autoincrement())
//   type                                          TypeHumanServiceReportLead
//   value                                         String
//   createAt                                      DateTime                                    @default(now())
//   updateAt                                      DateTime                                    @default(now()) @updatedAt
//   humanServiceOnBusinessOnContactsWAOnAccountId Int
//   HumanServiceOnBusinessOnContactsWAOnAccount   HumanServiceOnBusinessOnContactsWAOnAccount @relation(fields: [humanServiceOnBusinessOnContactsWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, type, humanServiceOnBusinessOnContactsWAOnAccountId])
// }

// model ScheduledMessages {
//   id                    Int                 @id @default(autoincrement())
//   message               String
//   isSent                Boolean?            @default(false)
//   date                  DateTime
//   createAt              DateTime            @default(now())
//   updateAt              DateTime            @default(now()) @updatedAt
//   contactsWAOnAccountId Int
//   ContactsWAOnAccount   ContactsWAOnAccount @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, isSent])
// }

// model EmailServiceConfiguration {
//   id                                  Int                                   @id @default(autoincrement())
//   interrupted                         Boolean                               @default(false)
//   host                                String
//   port                                Int
//   secure                              Boolean?                              @default(false)
//   user                                String
//   pass                                String
//   createAt                            DateTime                              @default(now())
//   updateAt                            DateTime                              @default(now()) @updatedAt
//   accountId                           Int
//   Account                             Account                               @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   EmailServiceConfigurationOnBusiness EmailServiceConfigurationOnBusiness[]

//   @@index([id, accountId])
// }

// model EmailServiceConfigurationOnBusiness {
//   id                          Int                       @id @default(autoincrement())
//   businessId                  Int
//   Business                    Business                  @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   emailServiceConfigurationId Int
//   EmailServiceConfiguration   EmailServiceConfiguration @relation(fields: [emailServiceConfigurationId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, businessId, emailServiceConfigurationId])
// }

// model LinkTrackingPixel {
//   id                      Int                       @id @default(autoincrement())
//   interrupted             Boolean                   @default(false)
//   name                    String
//   link                    String
//   createAt                DateTime                  @default(now())
//   updateAt                DateTime                  @default(now()) @updatedAt
//   accountId               Int
//   Account                 Account                   @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   businessId              Int
//   Business                Business                  @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   LinkTrackingPixelEvents LinkTrackingPixelEvents[]

//   @@index([id, accountId, businessId])
// }

// model LinkTrackingPixelEvents {
//   id                    Int                  @id @default(autoincrement())
//   event                 String
//   value                 String
//   createAt              DateTime             @default(now())
//   updateAt              DateTime             @default(now()) @updatedAt
//   contactsWAOnAccountId Int
//   ContactsWAOnAccount   ContactsWAOnAccount  @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   campaignId            Int?
//   Campaign              Campaign?            @relation(fields: [campaignId], references: [id], onDelete: SetNull, onUpdate: Cascade)
//   linkTrackingPixelId   Int
//   LinkTrackingPixel     LinkTrackingPixel    @relation(fields: [linkTrackingPixelId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   accountId             Int
//   Account               Account              @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   connectionWhatsId     Int
//   Connection            ConnectionOnBusiness @relation(fields: [connectionWhatsId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, event, value])
// }

// enum TypeArtificialIntelligence {
//   OPENAI
//   DEEPSEEK
// }

// enum ModelArtificialIntelligence {
//   DeepseekChat
//   DeepseekReasoner
//   Gpt4
//   Gpt4Turbo
//   Gpt4o
//   Gpt4oMini
//   O1
//   O1Mini
//   Gpt35Turbo0125
// }

// model ArtificialIntelligence {
//   id                               Int                                @id @default(autoincrement())
//   name                             String
//   description                      String?                            @db.Text
//   apiKey                           String
//   model                            ModelArtificialIntelligence
//   type                             TypeArtificialIntelligence
//   temperature                      Decimal?                           @default(0.1) @db.Decimal(2, 1)
//   createAt                         DateTime                           @default(now())
//   updateAt                         DateTime                           @default(now()) @updatedAt
//   accountId                        Int
//   Account                          Account                            @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   ArtificialIntelligenceOnBusiness ArtificialIntelligenceOnBusiness[]
//   AttendantOnAI                    AttendantOnAI[]

//   @@index([id, name, model, type, accountId])
// }

// model ArtificialIntelligenceOnBusiness {
//   id                     Int                    @id @default(autoincrement())
//   businessId             Int
//   Business               Business               @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   aiId                   Int
//   ArtificialIntelligence ArtificialIntelligence @relation(fields: [aiId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, businessId, aiId])
// }

// model AttendantOnAI {
//   id                      Int                       @id @default(autoincrement())
//   name                    String
//   description             String?                   @db.Text
//   briefing                String?                   @db.Text
//   personality             String?                   @db.Text
//   role                    String?                   @db.Text
//   definitions             String?                   @db.Text
//   knowledgeBase           String?                   @db.Text
//   createAt                DateTime                  @default(now())
//   updateAt                DateTime                  @default(now()) @updatedAt
//   aiId                    Int
//   ArtificialIntelligence  ArtificialIntelligence    @relation(fields: [aiId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   accountId               Int
//   Account                 Account                   @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   AttendantOnAIOnBusiness AttendantOnAIOnBusiness[]
//   FilesOnAttendantOnAI    FilesOnAttendantOnAI[]

//   @@index([id, name, aiId, accountId])
// }

// model FilesOnAttendantOnAI {
//   id            Int           @id @default(autoincrement())
//   filename      String
//   originalname  String
//   attendantAIId Int
//   AttendantOnAI AttendantOnAI @relation(fields: [attendantAIId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, originalname])
// }

// model AttendantOnAIOnBusiness {
//   id            Int           @id @default(autoincrement())
//   businessId    Int
//   Business      Business      @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
//   attendantId   Int
//   AttendantOnAI AttendantOnAI @relation(fields: [attendantId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, businessId, attendantId])
// }

model FbPixel {
  id           Int       @id @default(autoincrement())
  name         String
  pixel_id     String
  access_token String    @db.VarChar(240)
  status       Boolean   @default(true)
  createAt     DateTime  @default(now())
  updateAt     DateTime  @default(now()) @updatedAt
  accountId    Int
  businessId   Int?
  Account      Account   @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Business     Business? @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([id, name, pixel_id, businessId, accountId])
}

// enum TypeDistributionSectors {
//   normal
//   sequential
//   balanced
// }

enum TypeTag {
  contactwa
  audience
}

// enum TypeAccount {
//   professional
//   personal
// }

// enum TypePlan {
//   free
//   paid
// }

enum AccountLogDateType {
  CONVERSATIONS_STARTED_BOT
  NEW_CONTACT
}

model AccountLogDate {
  id        Int                @id @default(autoincrement())
  type      AccountLogDateType
  accountId Int
  Account   Account            @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  createAt  DateTime           @default(now())

  @@index([accountId, createAt, type])
}

enum GeralLogDateType {
  TRACE //  log mais verboso, passo-a-passo
  DEBUG //  infos de depuração
  INFO //   eventos normais de runtime
  WARN //   algo fora do esperado, mas não quebrei
  ERROR //  falha recuperável
  FATAL //  falha crítica, vai derrubar o app
}

model GeralLogDate {
  id       Int              @id @default(autoincrement())
  hash     String
  type     GeralLogDateType
  entity   String
  value    String           @db.Text
  createAt DateTime         @default(now())

  @@index([createAt, type])
}

enum TypeProviderCredential {
  openai
}

model ProviderCredential {
  id        Int                    @id @default(autoincrement())
  provider  TypeProviderCredential
  label     String
  apiKey    String
  accountId Int
  Account   Account                @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  createAt  DateTime               @default(now())
  AgentAI   AgentAI[]

  @@unique([label, accountId, provider])
  @@index([createAt, label, accountId, provider])
}

enum TypeEmojiLevel {
  none
  low
  medium
  high
}

enum TypeServiceTier {
  default
  flex
  auto
  scale
  priority
}

model AgentAI {
  id                    Int                    @id @default(autoincrement())
  name                  String
  service_tier          TypeServiceTier        @default(default)
  personality           String?                @db.Text
  vectorStoreId         String?
  knowledgeBase         String?                @db.Text
  instructions          String?                @db.Text
  timeout               Int                    @default(900)
  debounce              Int                    @default(9)
  emojiLevel            TypeEmojiLevel         @default(none)
  language              String                 @default("PT-BR")
  model                 String
  temperature           Decimal                @default(0.1) @db.Decimal(2, 1)
  createAt              DateTime               @default(now())
  updateAt              DateTime               @default(now()) @updatedAt
  accountId             Int
  connectionWAId        Int?                   @unique
  chatbotId             Int?                   @unique
  providerCredentialId  Int
  Account               Account                @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ConnectionWA          ConnectionWA?          @relation(fields: [connectionWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Chatbot               Chatbot?               @relation(fields: [chatbotId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ProviderCredential    ProviderCredential     @relation(fields: [providerCredentialId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  AgentAIOnBusiness     AgentAIOnBusiness[]
  StoragePathsOnAgentAI StoragePathOnAgentAI[]

  @@index([id, name, accountId])
}

model AgentAIOnBusiness {
  id         Int      @id @default(autoincrement())
  businessId Int
  Business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  agentId    Int
  AgentAI    AgentAI  @relation(fields: [agentId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([businessId, agentId])
}

model StoragePathOnAgentAI {
  id            Int          @id @default(autoincrement())
  fileId        String?
  agentAIId     Int
  AgentAI       AgentAI      @relation(fields: [agentAIId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  storagePathId Int
  StoragePaths  StoragePaths @relation(fields: [storagePathId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([agentAIId, storagePathId])
}

enum TypeProviderPayment {
  mercadopago
}

model PaymentIntegrations {
  id           Int                 @id @default(autoincrement())
  name         String              @db.VarChar(150)
  provider     TypeProviderPayment @default(mercadopago)
  status       Boolean             @default(true)
  access_token String              @db.VarChar(240)
  createAt     DateTime            @default(now())
  updateAt     DateTime            @default(now()) @updatedAt
  accountId    Int
  Account      Account             @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Charges      Charges[]

  @@index([id, name, accountId, status])
}

model TrelloIntegration {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(150)
  status    Boolean  @default(true)
  key       String   @db.VarChar(240)
  token     String   @db.VarChar(240)
  createAt  DateTime @default(now())
  updateAt  DateTime @default(now()) @updatedAt
  accountId Int
  Account   Account  @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([id, name, accountId, status])
}

enum TypeStatusOrder {
  draft
  pending
  processing
  confirmed
  completed
  shipped
  delivered
  cancelled
  returned
  refunded
  failed
  on_way
  ready
}

enum TypePriorityOrder {
  low
  medium
  high
  urgent
  critical
}

model Orders {
  id                    Int                  @id @default(autoincrement())
  n_order               String
  name                  String?              @db.VarChar(150)
  description           String?              @db.Text
  payment_method        String?
  deleted               Boolean              @default(false)
  status                TypeStatusOrder      @default(draft)
  isDragDisabled        Boolean              @default(false)
  priority              TypePriorityOrder?
  origin                String?              @db.VarChar(150)
  delivery_address      String?              @db.Text
  delivery_complement   String?
  delivery_cep          String?
  who_receives          String?
  rank                  Decimal              @db.Decimal(20, 10)
  tracking_code         String?              @db.VarChar(150)
  delivery_code         String?              @db.VarChar(12)
  itens_count           Int?                 @default(0)
  completedAt           DateTime?
  data                  String?              @db.Text
  total                 Decimal?             @db.Decimal(10, 2)
  net_total             Decimal?             @db.Decimal(10, 2)
  createAt              DateTime             @default(now())
  updateAt              DateTime             @default(now()) @updatedAt
  connectionWAId        Int?
  actionChannels        String[] // são listas de botão que aparece no pedido, e quando clica dispara uma ação no node que criou o pedido e a saida é com o valor clicado > e pode ser recuperado pelo proximo node REPLY ou SWFTH, 
  flowNodeId            String?
  flowId                String?
  menuId                Int?
  flowStateId           Int? // flow onde esse node foi executado
  // qual ticket gerou o pedido
  // qual atendente gerou o pedido
  contactsWAOnAccountId Int?
  accountId             Int
  businessId            Int
  Business              Business             @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  menuOnline            MenusOnline?         @relation(fields: [menuId], references: [id], onDelete: SetNull)
  FlowState             FlowState?           @relation(fields: [flowStateId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  ContactsWAOnAccount   ContactsWAOnAccount? @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  ConnectionWA          ConnectionWA?        @relation(fields: [connectionWAId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  Account               Account              @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Charges               Charges[]

  @@index([id, name, accountId])
}

// log de atualização de status de pedidos. serve para manter o histórico de mudanças de status dos pedidos
// e também para permitir que o usuário veja o histórico de mudanças de status de um pedido específico
// model OrdersLog {
//   id          Int                @id @default(autoincrement())
//   orderId     Int
//   status      TypeStatusOrder
//   note             String?            @db.Text
//   createAt    DateTime           @default(now())
//   Orders      Orders             @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: Cascade)

//   @@index([id, orderId, status, createAt])
// }

enum PaymentStatus {
  created // O pagamento foi criado, mas ainda não foi processado
  pending // O usuário ainda não concluiu o processo de pagamento
  approved // O pagamento foi aprovado e creditado com sucesso
  authorized // autorizado mas ainda nao foi capturado.
  in_process // em processo de pagamento
  in_mediation // usuario iniciou uma disputa
  rejected // pagamento recusado, mas o usuario pode tentar novamente
  charged_back // Um chargeback foi aplicado no cartão de crédito do comprador
  refunded // pagamento foi reembolsado
  refused // O pagamento foi recusado, o usuário não pode tentar novamente 
  cancelled // O pagamento foi cancelado por uma das partes ou expirou
}

enum TypeMethodCharge {
  pix
}

model Charges {
  id                    Int                  @id @default(autoincrement())
  hash                  String               @default(uuid()) // prevenir alterar status de pagamento pelo id ou transactionId, as atualizações devem ser feitas pelo hash
  provider              TypeProviderPayment  @default(mercadopago)
  transactionId         String
  total                 Decimal              @db.Decimal(10, 2)
  net_total             Decimal              @db.Decimal(10, 2)
  currency              String               @db.VarChar(10)
  status                PaymentStatus        @default(created)
  deleted               Boolean              @default(false)
  method_type           TypeMethodCharge
  content               String?              @db.Text
  metadata              Json?
  flowNodeId            String?
  contactsWAOnAccountId Int?
  businessId            Int?
  createAt              DateTime             @default(now())
  accountId             Int
  paymentIntegrationId  Int?
  orderId               Int?
  flowStateId           Int?
  inboxUserId           Int?
  ticketId              Int?
  updatedAt             DateTime             @updatedAt
  Account               Account              @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ContactsWAOnAccount   ContactsWAOnAccount? @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  Ticket                Tickets?             @relation(fields: [ticketId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  InboxUser             InboxUsers?          @relation(fields: [inboxUserId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  Business              Business?            @relation(fields: [businessId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  Order                 Orders?              @relation(fields: [orderId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  PaymentIntegration    PaymentIntegrations? @relation(fields: [paymentIntegrationId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  FlowState             FlowState?           @relation(fields: [flowStateId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@index([provider, transactionId, ticketId, inboxUserId, status, deleted])
}

model LogSystem {
  id             Int           @id @default(autoincrement())
  name           String
  description    String        @db.Text
  accountId      Int?
  connectionWAId Int?
  createAt       DateTime      @default(now())
  Account        Account?      @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ConnectionWA   ConnectionWA? @relation(fields: [connectionWAId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([id, connectionWAId, accountId])
}

model MenusOnline {
  id             Int          @id @default(autoincrement())
  uuid           String       @unique @default(uuid())
  identifier     String       @unique
  logoImg        String
  desc           String?
  bg_primary     String?
  bg_secondary   String?
  bg_tertiary    String?
  logoLabel      String?      @db.Text
  titlePage      String?
  status         Boolean?     @default(false)
  createAt       DateTime     @default(now())
  accountId      Int
  Account        Account      @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  connectionWAId Int
  ConnectionWA   ConnectionWA @relation(fields: [connectionWAId], references: [id], onDelete: Restrict, onUpdate: Cascade)

  Orders           Orders[]
  SizesPizza       SizesPizza[]
  MenusOnlineItems MenusOnlineItems[]

  @@index([id, uuid, accountId])
}

model SizesPizza {
  id       Int         @id @default(autoincrement())
  uuid     String      @unique @default(uuid())
  name     String
  price    Decimal     @db.Decimal(6, 2)
  flavors  Int
  slices   Int?
  createAt DateTime    @default(now())
  menuId   Int
  Menu     MenusOnline @relation(fields: [menuId], references: [id], onDelete: Cascade)

  @@index([id, menuId])
}

enum TypeCategory {
  pizzas
  drinks
}

model MenusOnlineItems {
  id          Int          @id @default(autoincrement())
  uuid        String       @unique @default(uuid())
  name        String
  desc        String?
  category    TypeCategory
  img         String
  qnt         Int          @default(0)
  beforePrice Decimal?     @db.Decimal(6, 2)
  afterPrice  Decimal?     @db.Decimal(6, 2)
  accountId   Int?
  createAt    DateTime     @default(now())
  updateAt    DateTime     @default(now())
  menuId      Int

  Menu    MenusOnline @relation(fields: [menuId], references: [id], onDelete: Cascade)
  Account Account?    @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([uuid, menuId, accountId])
}

enum TypeChannelsNotification {
  websocket
  push
  email
  wa
}

enum TypeStatusChannelsNotification {
  unread
  read
}

model Notifications {
  id             Int                            @id @default(autoincrement())
  type           String?
  title_txt      String // mostrado no push
  body_txt       String
  title_html     String? // mostrado no toast
  body_html      String?
  channels       TypeChannelsNotification[]
  toast_position String?
  toast_duration Int?
  status         TypeStatusChannelsNotification @default(unread)
  url_redirect   String?
  readAt         DateTime?
  createAt       DateTime                       @default(now())
  updateAt       DateTime                       @default(now())
  accountId      Int? // caso não tenha o account, significa que todos serão notificados.
  Account        Account?                       @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model PushTokens {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  platform   String
  lastUsedAt DateTime @default(now())
  createAt   DateTime @default(now())
  accountId  Int
  Account    Account  @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

enum TypeCreateByAppointments {
  human
  bot
}

enum StatusAppointments {
  suggested
  pending_confirmation
  confirmed
  canceled
  completed
  expired
}

model Appointments {
  id                    Int                      @id @default(autoincrement())
  title                 String
  desc                  String?                  @db.Text
  n_appointment         String
  status                StatusAppointments
  startAt               DateTime
  endAt                 DateTime
  createdBy             TypeCreateByAppointments @default(bot)
  createAt              DateTime                 @default(now())
  updateAt              DateTime                 @default(now())
  accountId             Int
  businessId            Int
  actionChannels        String[] // são listas de botão que aparece no compromisso, e quando clica dispara uma ação no node que criou o pedido e a saida é com o valor clicado > e pode ser recuperado pelo proximo node REPLY ou SWFTH, 
  flowNodeId            String?
  flowId                String?
  flowStateId           Int?
  contactsWAOnAccountId Int?
  connectionWAId        Int?
  deleted               Boolean                  @default(false)
  Business              Business                 @relation(fields: [businessId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  FlowState             FlowState?               @relation(fields: [flowStateId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  ContactsWAOnAccount   ContactsWAOnAccount?     @relation(fields: [contactsWAOnAccountId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  ConnectionWA          ConnectionWA?            @relation(fields: [connectionWAId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  Account               Account                  @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  appointmentReminders  AppointmentReminders[]
}

enum StatusAppointmentReminders {
  pending
  sent
  failed
  canceled
}

model AppointmentReminders {
  id            Int                        @id @default(autoincrement())
  notify_at     DateTime
  deleted       Boolean                    @default(false)
  status        StatusAppointmentReminders @default(pending)
  // saida do node
  moment        String // cada lembrete terá seu id do handle de saida referente ao tempo de notificação(24h, 2h, 20min)
  // nesse lembrete de notificar antes das 24h vai ter o id do handle de saida de 24h. 
  appointmentId Int
  updateAt      DateTime                   @default(now())
  createAt      DateTime                   @default(now())
  Appointment   Appointments               @relation(fields: [appointmentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}
